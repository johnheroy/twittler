<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <div class="container">
      <div class="logo">twittler</div>
      <div class="compose">
        <div class="compose-title">Compose</div>
        <form>
          <span class="compose-label">Username: </span>
          <input class="compose-input" type="text" placeholder="who are you?"><br>
          <span class="compose-label">Message: </span>
          <input class="compose-input" type="text" placeholder="write a message">
        </form>
      </div>
      <div class="new-tweets" style="display: none">
        <a href="#" class="new-tweets-button"></a>
      </div>
      <div class="tweets"></div>
    </div>

    <script>

      $(document).ready(function(){
        var $body = $('body');
        var $tweets = $('.tweets');
        var $newTweets = $('.new-tweets');
        var newTweetCount = 0;

        var displayTweet = function(tweet) {
          var $tweet = $('<div class="tweet" style="display: none"></div>');

          // username
          $username = $('<div class="tweet-username"></div>');
          $username.text('@' + tweet.user);
          $username.appendTo($tweet);

          // time
          $time = $('<div class="tweet-time"></div>');
          $time.text(tweet.created_at);
          $time.appendTo($tweet);

          // message
          $message = $('<div class="tweet-message"></div>');
          $message.text(tweet.message);
          $message.appendTo($tweet);

          $tweet.prependTo($tweets);

          newTweetCount += 1;
          if (newTweetCount === 1) {
            $('.new-tweets-button').text('There is ' + newTweetCount + ' new tweet!');  
          } else {
            $('.new-tweets-button').text('There are ' + newTweetCount + ' new tweets!');  
          }
          $newTweets.show(500);
          $tweets.height(479);

        };

        var fetchNewTweets = function() {
          var index = streams.home.length - 1;
          while(index >= 0) {
            var tweet = streams.home[index];

            if (!tweet.loaded) {
              displayTweet(tweet);  
              tweet.loaded = true;  
            } else {
              // do nothing if tweet already read
              break;
            }

            index -= 1;
          }
        };

        var showNewTweets = function () {
          $tweets.children().show();
          newTweetCount = 0;
          $newTweets.hide();
          $tweets.height(480);
        };

        $('.new-tweets-button').on('click', function() {
          showNewTweets();
        });
        
        fetchNewTweets();
        showNewTweets();
        setInterval(function() {
          fetchNewTweets();
        }, 1000);

      });

    </script>
  </body>
</html>
